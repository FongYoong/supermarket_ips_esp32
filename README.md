## ESP32 code for VLC-based Supermarket IPS

***

## Transmitter
* [⭳ Download compiled binary](https://github.com/FongYoong/supermarket_ips_esp32/releases/latest/download/led_transmitter.ino.esp32.bin)
* Code located at [/led_transmitter](https://github.com/FongYoong/supermarket_ips_esp32/blob/master/led_transmitter)
* The program modulates 4 LEDs at distinct frequencies.

***

## Trolley/Receiver
* [⭳ Download compiled binary](https://github.com/FongYoong/supermarket_ips_esp32/releases/latest/download/trolley.ino.esp32.bin)
* Code located at [/trolley/src](https://github.com/FongYoong/supermarket_ips_esp32/blob/master/trolley/src)
* The program comprises of multiple sections, each managing a specific purpose, such as the [Bluetooth server](https://github.com/FongYoong/supermarket_ips_esp32/tree/master/trolley/src/BluetoothUtils), [user interface](https://github.com/FongYoong/supermarket_ips_esp32/tree/master/trolley/src/UserInterface) and [position estimation](https://github.com/FongYoong/supermarket_ips_esp32/tree/master/trolley/src/Vlc).

#### External Dependencies/Libraries
* [Firebase-ESP32](https://github.com/mobizt/Firebase-ESP32). **Avoid HTTP streams as they consume a lot of memory.**
* [ThingPulse OLED SSD1306](https://github.com/ThingPulse/esp8266-oled-ssd1306) for the OLED display
* [arduinoFFT](https://github.com/kosme/arduinoFFT) for Fast Fourier Transform
* [NimBLE-Arduino](https://github.com/h2zero/NimBLE-Arduino) which is a  lighter version of the Bluetooth library with smaller memory footprint. Without this, there is not enough memory to run both Bluetooth and Wi-Fi at the same time.




#### Creating the QR code for OLED display

1. In [GoQR](https://goqr.me/), type the trolley ID and download a PNG of the QR code.
    ![Generate](https://i.imgur.com/5K1zAqR.png)

    Change the QR code to the minimum which is 150 x 150 pixels.
    ![Generate_size](https://i.imgur.com/C5IPQhS.png)

2. Use [this PNG resizer website](https://onlinepngtools.com/resize-png) to resize the QR code to 60 x 60 pixels.
    ![Resize](https://i.imgur.com/pTwtLuk.png)

3. Use [this XBM converter website](https://windows87.github.io/xbm-viewer-converter/) to convert the resized PNG to XBM format. The generated byte array in C code represents the QR image and can be displayed on the OLED display.
    ![XBM](https://i.imgur.com/68RlWzg.png)

4. In this project, the QR code is located at [/trolley/src/UserInterface/images/qr_code.h](https://github.com/FongYoong/supermarket_ips_esp32/blob/master/trolley/src/UserInterface/images/qr_code.h)